# Baby Theremin – Songs & Shapes (v3.4.7)

## v3.4.7 の狙い（重要）
「中央の絵文字は出るがネオン線画が出ない」端末があるため、**canvas描画を廃止してSVG描画に切り替え**ました。
これにより、ネオン線画が確実に表示されます。

## 仕様
- 起動時：6曲からランダム
- 左下アイコンで曲切替（☆ 🐑 🐻 🦋 🐝 🐸）
- 短タップ：はじける（Chime）
- 長押し＋上下：テルミン

- v3.4.7: ネオンが「意味不明な塊」になる端末対策として、SVGのdrop-shadowを廃止し、線画パスを“より記号的に読める”形に描き直しました。

- v3.4.7: ビジュアルを「スクショのような抽象ネオン（星・リング・三角・ハート・ダイヤ）」に変更。描画はSVG＋ガウシアンぼかしフィルタで安定表示。

- v3.4.7: ビジュアルを「曲に対応する動物（☆/羊/クマ/蝶/ハチ/カエル）」に復帰。描画はSVGで安定表示し、外側だけ軽いぼかし発光。

- v3.4.7: SVGのスケールが線幅まで拡大されて「巨大な丸い塊」に見える端末があったため、vector-effect: non-scaling-stroke を付与して線幅を固定しました（本来のネオン線画になります）。

- v3.4.7: ネオン線画を“かわいい”寄りに（目・口など）調整し、数を減らしました（12個）。テルミンの音程が高いほど絵が大きく、低いほど小さくなります。

- v3.4.7: 絵のサイズがテルミン音程に確実に連動するよう修正（pointermove時に常時pitch→visual更新、スケール範囲を拡大、スムージング追加）。

- v3.4.7: (修正) 絵の変形が効かない原因だったSVG transformの文字列誤りを修正。さらに setPitchFromY が visualPitchNorm を更新していなかったため、音程→絵サイズ連動が無効でした。これを修正し、絵の数も9個に減らしました。

- v3.4.7: (致命修正) SVG transform のテンプレ文字列が壊れており描画ループが停止していました。これを修正し、不要な curve ブロックも除去しました。

- v3.4.7: 全曲を“フル尺メロディ”に更新（短いループを廃止）。拍子ベースのアクセント（強拍/弱拍）＋ノート個別vで、歌っぽい抑揚に寄せました。

- v3.4.7: 各曲のメロディを修正（ぶんぶんぶん=PDF譜面準拠、かえるのうた=譜面準拠）。ちょうちょうは「ちょうちょ、ちょうちょ」で1拍休符を挿入。森のくまさんはメロディを再定義（6拍子寄せ、フレーズ間に小休止）。

- v3.4.7: メリーさんの羊の抑揚（アクセント）を自然寄せ（拍アクセントを撤廃）。ぶんぶんぶんのメロディをドレミ譜面の音列に差し替え。森のくまさんを黒鍵/低音オクターブを使わない簡易メロディに置換。

- v3.4.7: サービスワーカー登録URLが古いままで更新が反映されない不具合を修正（sw.js?v=バージョン を最新に）。

- v3.4.7: 「森のくまさん」を譜面（ドレミ表記）ベースで再実装（#とオクターブ含む）。「メリーさんの羊」は拍アクセント/強調を排し、均一ダイナミクス＋フレーズ休符のみで自然化。※更新が反映されるよう sw.js?v とCACHE名も更新。

- v3.4.7: 森のくまさんの前奏（ピックアップ3音）を削除。曲再生（playNote）の微小detune（±3cent）を撤廃して、音程が外れる感じを解消。

- v3.4.7: “更新されない”対策として、バージョンが変わったときに一度だけService Worker登録解除＋Cache削除→強制リロードするガードを追加。
